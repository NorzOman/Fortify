package com.centaurwarchief.smslistener;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.provider.Telephony;
import android.telephony.SmsMessage;
import android.util.Log;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.WritableNativeMap;
import com.facebook.react.modules.core.DeviceEventManagerModule;

/* loaded from: classes.dex */
public class SmsReceiver extends BroadcastReceiver {
    private static final String EVENT = "com.centaurwarchief.smslistener:smsReceived";
    private ReactApplicationContext mContext;

    public SmsReceiver() {
    }

    public SmsReceiver(ReactApplicationContext reactApplicationContext) {
        this.mContext = reactApplicationContext;
    }

    private void receiveMessage(SmsMessage smsMessage, String str) {
        ReactApplicationContext reactApplicationContext = this.mContext;
        if (reactApplicationContext != null && reactApplicationContext.hasActiveCatalystInstance()) {
            Log.d("SmsListenerPackage", String.format("%s: %s", smsMessage.getOriginatingAddress(), smsMessage.getMessageBody()));
            WritableNativeMap writableNativeMap = new WritableNativeMap();
            writableNativeMap.putString("originatingAddress", smsMessage.getOriginatingAddress());
            if (str.length() <= 0) {
                str = smsMessage.getMessageBody();
            }
            writableNativeMap.putString("body", str);
            writableNativeMap.putDouble("timestamp", smsMessage.getTimestampMillis());
            ((DeviceEventManagerModule.RCTDeviceEventEmitter) this.mContext.getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)).emit(EVENT, writableNativeMap);
        }
    }

    private void receiveMultipartMessage(SmsMessage[] smsMessageArr) {
        String displayMessageBody;
        SmsMessage smsMessage = smsMessageArr[0];
        if (smsMessageArr.length == 1 || smsMessage.isReplace()) {
            displayMessageBody = smsMessage.getDisplayMessageBody();
        } else {
            StringBuilder sb = new StringBuilder();
            for (SmsMessage smsMessage2 : smsMessageArr) {
                sb.append(smsMessage2.getMessageBody());
            }
            displayMessageBody = sb.toString();
        }
        receiveMessage(smsMessage, displayMessageBody);
    }

    @Override // android.content.BroadcastReceiver
    public void onReceive(Context context, Intent intent) {
        receiveMultipartMessage(Telephony.Sms.Intents.getMessagesFromIntent(intent));
    }
}
